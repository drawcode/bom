<?py app = bom.bom_json['app'] ?>
<?py app_name = bom.to_camel_cap(app,'_') ?>
-- -----------------------------------------------------------------------------
-- SQL SETUP 
-- -----------------------------------------------------------------------------
-- TABLES

/*
<?py for model in bom.bom_json['models']: ?>
    <?py if bom.should_generate_data(model['id']):?>
        <?py model_id = model['id'] ?>
        <?py model_name = bom.to_camel_cap(model['id'],'_') ?>
-- -----------------------------------------------------------------------------
IF EXISTS (SELECT * FROM dbo.sysobjects where id = object_id(N'[dbo].[#{model_id}]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1)
DROP TABLE [dbo].[#{model_id}]
GO
    <?py #endif ?>
<?py #endif ?>
*/


<?py for model in bom.bom_json['models']: ?>
    <?py if bom.should_generate_data(model['id']):?>
        <?py model_id = model['id'] ?>
        <?py model_name = bom.to_camel_cap(model['id'],'_') ?>
CREATE TABLE [dbo].[#{model_id}] 
(
        <?py inc = 0 ?>
        <?py for item, item_data in bom.bom_model_properties_extended(model_id).iteritems() : ?>
            <?py if inc == 0: ?>
    [#{item}] #{bom.bom_data_type_table_formatted(item_data)}
            <?py else: ?>
    , [#{item}] #{bom.bom_data_type_table_formatted(item_data)}
            <?py #endif ?>
            <?py if item_data['type'] == 'datetime': ?>
                CONSTRAINT DF_#{model_id}_#{item} DEFAULT GETDATE()
            <?py #endif ?>
            <?py if item_data['type'] == 'bool': ?>
                CONSTRAINT DF_#{model_id}_#{item}_bool DEFAULT 1
            <?py #endif ?>
            <?py inc = inc + 1 ?>
        <?py #end ?>
)
GO
ALTER TABLE [dbo].[#{model_id}] ADD 
    CONSTRAINT [PK_#{model_id}] PRIMARY KEY CLUSTERED 
    (
            [uuid]
    )
GO
    <?py #endif ?>
<?py #endif ?>
